$(document).ready(function() {
  var DOTstring = $("#dot_string").html().replace(new RegExp('&gt;', 'g'), '>');
  var parsedData = vis.network.convertDot(DOTstring);
  
  var data = {
    nodes: parsedData.nodes,
    edges: parsedData.edges
  }
  
  var options = {
    nodes:   {
      fixed: {
        x:true,
        y:true,
      }
    },
    layout: {
      hierarchical: {
        enabled: true,
        direction: "LR",
        sortMethod: "directed",
        levelSeparation: 1500,
      }
    }
  };
  
  var container = document.getElementById("mynetwork");
  var network = new vis.Network(container, data, options);
  // filter
  // var img = new Image();
  // img.src = 'static/visualization/rhino.jpg';
  // var canvas = document.getElementById('canvas');
  // var ctx = canvas.getContext('2d');

  // img.onload = function() {
  //   ctx.drawImage(img, 0, 0);
  //   img.style.display = 'none';
  // };

  // var color = document.getElementById('color');
  
  // function pick(event) {
  //   var x = event.layerX;
  //   var y = event.layerY;
  //   var pixel = ctx.getImageData(x, y, 1, 1);
  //   var data = pixel.data;
  //   var rgba = 'rgba(' + data[0] + ', ' + data[1] +
  //              ', ' + data[2] + ', ' + (data[3] / 255) + ')';
  //   color.style.background =  rgba;
  //   color.textContent = rgba;
  // }
  // canvas.addEventListener('mousemove', pick);


// var imgd = [27,32,26,28,33,27,30,35,29,31,36,30,32,37,31,32,37,31,32,37,31,31,36,30,32,37,31,34,39,33,35,40,34,35,40,34,33,38,32,34,39,33,36,41,35,39,44,38,39,41,36,39,41,36,37,42,38,35,41,37,35,41,39,33,42,39,33,42,41,33,42,41,37,43,41,37,43,39,38,40,37,36,39,32,35,34,29,31,31,21,29,26,17,28,24,13,46,37,32,45,34,30,46,33,27,49,36,30,53,40,34,56,43,37,57,42,35,56,41,34,76,59,51,76,59,51,77,60,52,78,61,53,78,60,50,71,53,43,61,43,33,52,34,22,52,35,19,53,36,18,53,36,18,54,37,19,53,37,21,52,36,20,52,36,21,51,35,20,44,31,15,47,34,18,50,38,24,58,46,32,68,56,44,79,67,55,87,77,65,94,82,68,83,70,53,84,69,50,76,63,46,70,57,40,71,57,44,74,60,47,69,57,45,61,48,39,44,34,25,42,31,25,40,29,25,37,26,22,34,24,23,32,22,21,31,21,22,31,21,20,32,23,18,37,28,21,36,27,20,27,18,11,23,14,7,32,23,16,43,34,27,48,39,32,27,18,11,31,22,15,34,25,18,34,25,18,31,22,15,30,21,14,32,23,16,33,26,18,33,25,22,31,26,22,30,25,21,30,25,21,32,25,19,31,24,18,31,24,18,31,24,18,37,28,21,40,31,24,48,38,29,59,49,40,69,59,50,75,65,56,77,64,55,75,62,53,103,90,82,99,86,78,92,79,71,78,65,57,56,43,35,38,25,17,35,22,14,40,27,19,47,34,26,41,28,20,37,24,16,39,26,18,46,33,25,51,38,30,51,38,30,48,35,27,50,40,31,46,36,27,43,34,27,46,37,30,54,47,41,63,58,52,71,66,63,73,72,68,81,79,80,86,88,87,92,93,97,88,93,96,82,87,93,77,84,90,80,87,93,84,91,99,82,86,97,84,88,100,84,90,102,87,93,105,87,96,105,87,96,105,85,95,104,84,94,103,90,99,106,89,98,105,89,96,104,92,96,105,95,98,105,100,100,108,104,103,111,105,104,112,30,35,29,31,36,30,33,38,32,34,39,33,35,40,34,35,40,34,34,39,33,34,39,33,35,40,34,37,42,36,39,44,38,38,43,37,36,41,35,36,41,35,38,43,37,41,46,40,39,41,36,39,41,36,37,42,38,36,42,38,35,41,39,33,42,39,33,42,41,33,42,41,35,41,39,35,41,37,38,40,37,37,40,33,37,36,31,35,35,25,34,31,22,34,30,19,42,33,26,45,34,30,51,38,32,58,45,39,63,50,44,64,51,45,61,46,39,57,42,35,66,49,41,65,48,40,66,49,41,70,53,45,75,57,47,73,55,45,67,49,39,60,42,30,59,42,26,59,42,24,59,42,24,59,42,24,57,41,25,57,41,25,56,40,25,56,40,25,55,42,26,54,41,25,53,41,27,55,43,29,62,50,38,73,61,49,81,71,59,90,78,64,89,76,59,92,77,58,86,73,56,77,64,47,72,58,45,70,56,43,62,50,38,53,40,31,45,35,26,42,31,25,38,27,23,34,23,19,31,21,20,31,21,20,33,23,24,34,24,23,34,25,20,39,30,23,39,30,23,31,22,15,27,18,11,33,24,17,42,33,26,46,37,30,31,22,15,32,23,16,33,24,17,32,23,16,30,21,14,30,21,14,34,25,18,36,29,21,34,26,23,30,25,21,28,23,19,28,23,19,31,24,18,32,25,19,32,25,19,31,24,18,36,27,20,38,29,22,44,34,25,51,41,32,58,48,39,64,54,45,69,56,47,69,56,47,96,83,75,87,74,66,80,67,59,74,61,53,61,48,40,42,29,21,34,21,13,36,23,15,36,23,15,33,20,12,32,19,11,37,24,16,44,31,23,47,34,26,44,31,23,40,27,19,42,32,23,41,31,22,43,32,26,47,38,31,54,45,40,58,51,45,57,52,48,56,52,49,72,71,69,77,77,77,83,84,86,84,88,91,81,86,90,79,87,90,83,88,94,85,90,96,88,92,103,88,92,103,89,93,105,88,95,105,87,96,105,87,96,105,87,97,106,87,98,104,94,103,110,93,102,109,94,101,109,96,101,107,97,100,107,100,100,108,103,102,110,103,102,110,34,39,33,35,40,34,36,41,35,37,42,36,38,43,37,37,42,36,37,42,36,36,41,35,39,44,38,41,46,40,43,48,42,41,46,40,39,44,38,37,42,36,39,44,38,41,46,40,40,42,37,40,42,37,37,42,38,36,42,38,35,41,39,33,42,39,32,41,40,32,41,40,32,38,36,33,39,35,37,39,36,38,41,34,41,40,35,40,40,30,42,39,30,42,38,27,47,38,31,49,38,32,55,42,36,61,48,42,67,54,48,68,55,49,67,52,45,64,49,42,62,45,37,59,42,34,58,41,31,62,45,35,70,52,42,72,54,44,69,51,41,65,47,35,69,52,36,69,52,34,70,53,37,70,53,37,68,52,36,66,50,34,63,47,32,62,46,31,62,48,35,57,43,30,50,38,24,47,35,21,51,39,27,59,47,35,68,58,46,77,65,51,87,74,58,92,79,62,92,79,62,82,69,52,72,58,45,66,52,39,57,45,33,49,36,27,45,35,26,42,31,25,35,26,21,31,22,17,29,19,18,31,21,20,34,24,23,37,27,25,36,27,22,42,33,26,43,34,27,36,27,20,32,23,16,36,27,20,41,32,25,43,34,27,33,24,17,34,25,18,33,24,17,32,23,16,31,22,15,32,23,16,35,26,19,38,31,23,35,27,24,29,24,20,25,20,16,25,20,16,30,23,17,33,26,20,32,25,19,31,24,18,34,25,18,36,27,20,40,30,21,42,32,23,45,35,26,49,39,30,56,43,34,60,47,38,82,69,61,68,55,47,62,49,41,68,55,47,63,50,42,46,33,25,36,23,15,38,25,17,35,22,14,34,21,13,34,21,13,39,26,18,45,32,24,46,33,25,43,30,22,38,25,17,38,25,16,39,29,19,46,36,27,52,43,34,57,48,41,54,47,41,45,40,36,38,34,31,47,46,44,52,52,52,63,63,63,73,74,76,79,83,86,84,89,92,87,90,95,88,91,96,91,94,103,90,94,103,89,93,104,86,93,101,85,94,101,85,94,101,84,95,101,84,95,99,88,97,102,89,98,103,90,97,103,92,97,103,92,95,102,93,94,99,93,92,98,93,92,98,34,39,33,35,40,34,36,41,35,37,42,36,37,42,36,37,42,36,36,41,35,35,40,34,39,44,38,41,46,40,43,48,42,42,47,41,39,44,38,36,41,35,37,42,36,38,43,37,40,42,37,40,42,37,37,42,38,35,41,37,34,40,38,31,40,37,31,40,39,30,39,38,29,35,33,30,36,32,36,38,35,39,42,35,44,43,38,46,46,36,48,45,36,50,46,35,58,49,42,56,45,39,56,43,37,57,44,38,61,48,42,65,52,44,69,54,47,69,54,47,67,50,42,62,45,37,58,41,31,59,42,32,65,47,37,69,51,41,68,50,40,66,48,36,79,62,46,81,64,46,83,66,50,84,67,51,81,65,49,75,59,43,69,53,38,65,49,34,58,44,31,53,39,26,45,33,19,41,29,15,42,30,18,48,36,24,54,44,32,60,51,36,72,59,43,82,69,52,86,73,56,79,66,50,68,54,41,61,49,35,56,43,34,50,37,28,41,31,22,39,29,20,35,26,21,32,23,18,31,21,19,32,22,21,34,24,23,36,26,24,37,28,23,44,35,28,46,37,30,40,31,24,36,27,20,39,30,23,40,31,24,39,30,23,32,23,16,33,24,17,34,25,18,35,26,19,35,26,19,35,26,19,35,26,19,35,28,20,35,27,24,28,23,19,24,19,15,24,19,15,30,23,17,33,26,20,33,26,20,31,24,18,32,23,16,35,26,19,39,29,20,38,28,19,37,27,18,38,28,19,45,32,23,49,36,27,62,49,41,50,37,29,49,36,28,60,47,39,59,46,38,45,32,24,41,28,20,51,38,30,52,39,31,48,35,27,44,31,23,44,31,23,47,34,26,49,36,28,48,35,27,46,33,25,38,25,16,43,30,21,52,39,30,59,49,40,62,52,43,57,48,41,45,38,32,35,30,26,35,31,28,38,37,33,47,46,44,59,59,59,69,70,72,74,75,77,74,75,77,71,72,76,68,71,78,68,71,78,68,71,78,66,71,77,63,70,76,61,70,75,59,68,73,57,68,70,56,65,70,57,67,69,60,67,73,60,68,71,63,66,71,61,64,69,61,62,67,61,60,66,33,38,32,33,38,32,34,39,33,35,40,34,35,40,34,34,39,33,33,38,32,32,37,31,35,40,34,38,43,37,40,45,39,40,45,39,36,41,35,34,39,33,33,38,32,34,39,33,39,41,36,39,41,36,36,41,37,34,40,36,32,38,36,29,38,35,28,37,36,28,37,36,26,32,30,28,34,30,35,37,34,39,42,35,45,44,39,48,48,38,52,49,40,54,50,39,61,52,45,59,48,42,57,44,38,57,44,38,60,47,39,62,49,41,63,48,41,62,48,39,68,51,43,64,47,39,60,43,33,59,42,32,64,46,34,68,50,38,72,54,42,73,55,43,87,70,54,90,73,57,93,76,60,94,77,61,88,72,57,79,63,48,69,53,38,62,46,31,52,38,25,49,35,22,44,32,20,42,30,18,43,31,19,47,35,23,50,40,30,53,43,31,58,44,31,70,57,41,75,62,46,68,55,39,57,45,31,52,40,26,50,37,28,44,34,24,35,25,16,35,25,16,35,26,21,35,26,21,34,26,23,33,25,22,33,25,22,32,24,21,38,29,24,44,35,28,46,37,30,41,32,25,38,29,22,40,31,24,39,30,23,35,26,19,28,19,12,31,22,15,35,26,19,39,30,23,40,31,24,38,29,22,34,25,18,29,22,14,33,25,22,28,23,19,25,20,16,26,21,17,31,24,18,34,27,21,34,27,21,33,26,20,31,22,15,34,25,18,39,29,20,39,29,20,36,26,17,35,25,16,38,25,16,41,28,19,43,30,22,39,26,18,44,31,23,53,40,32,50,37,29,42,29,21,49,36,28,66,53,45,70,57,49,63,50,42,53,40,32,47,34,26,46,33,25,48,35,27,50,37,29,51,38,29,39,25,14,43,29,18,50,36,25,57,44,35,62,49,40,57,47,38,49,40,33,41,34,28,47,40,34,45,40,36,47,42,39,51,47,44,53,52,50,50,50,50,43,43,43,36,36,36,34,35,39,34,37,42,35,38,43,35,40,44,31,39,42,27,37,39,23,33,35,21,31,32,20,30,32,21,31,32,24,32,35,26,34,36,29,33,36,29,33,36,29,30,34,28,29,33,32,37,31,32,37,31,33,38,32,34,39,33,33,38,32,32,37,31,30,35,29,29,34,28,31,36,30,34,39,33,38,43,37,38,43,37,35,40,34,33,38,32,32,37,31,33,38,32,38,40,35,37,39,34,34,39,35,31,37,33,30,36,34,26,35,32,25,34,33,25,34,33,24,30,28,26,32,28,33,35,32,38,41,34,44,43,38,48,48,38,51,48,39,53,49,38,54,45,38,56,45,39,61,48,42,64,51,43,66,53,45,62,49,41,56,42,33,50,36,27,59,42,34,60,43,33,60,43,33,60,43,33,63,45,33,70,52,40,80,62,50,87,69,55,92,74,60,93,76,60,94,77,61,92,75,59,84,68,53,73,57,42,62,46,31,55,39,24,49,35,22,48,34,21,46,34,22,46,34,22,48,36,24,50,38,26,51,41,31,53,43,31,53,41,27,63,50,34,65,52,36,54,42,26,44,32,18,41,29,17,37,27,17,35,25,15,31,21,12,32,23,14,34,25,18,36,27,22,36,28,25,34,26,23,33,25,22,31,24,18,36,27,20,42,33,26,43,34,27,39,30,23,38,29,22,40,31,24,38,29,22,33,24,17,26,17,10,29,20,13,34,25,18,40,31,24,42,33,26,39,30,23,32,23,16,26,17,10,29,22,16,28,23,19,29,24,20,30,25,21,33,26,20,33,26,20,34,27,21,35,28,22,31,22,15,33,24,17,36,26,17,37,27,18,36,26,17,35,25,16,36,23,14,37,24,15,33,20,12,37,24,16,44,31,23,48,35,27,45,32,24,44,31,23,55,42,34,70,57,49,74,61,53,68,55,47,59,46,38,51,38,30,46,33,25,45,32,24,46,33,25,47,34,25,40,23,13,42,26,13,44,30,19,51,37,26,57,43,34,57,44,35,51,41,32,46,37,30,48,39,32,46,39,33,47,40,34,47,42,38,46,42,39,43,39,36,35,31,28,27,26,24,28,28,30,28,29,31,29,30,32,27,31,32,25,31,31,20,29,28,17,26,25,14,24,23,18,28,29,18,28,29,21,29,31,22,30,32,25,29,32,25,29,32,27,28,32,27,28,32,33,38,32,34,39,33,34,39,33,34,39,33,33,38,32,32,37,31,30,35,29,29,34,28,29,34,28,33,38,32,37,42,36,38,43,37,36,41,35,34,39,33,33,38,32,34,39,33,36,38,33,35,37,32,32,37,33,29,35,31,28,34,32,24,33,30,23,32,31,22,31,30,23,29,27,25,31,27,32,34,31,36,39,32,42,41,36,45,45,35,49,46,37,51,47,36,51,42,33,55,45,36,62,49,41,67,54,46,69,56,48,64,51,42,56,42,33,49,35,26,50,33,23,55,38,28,60,43,33,60,44,31,61,43,31,68,50,38,82,64,50,94,76,62,95,77,63,92,74,60,87,69,55,79,61,47,69,53,38,60,44,29,52,36,23,48,32,19,44,30,19,43,29,18,42,29,20,42,29,20,44,31,22,46,33,24,47,37,27,49,39,27,52,40,26,56,44,30,54,42,28,43,31,17,34,22,10,32,22,10,33,23,13,32,22,12,30,21,12,31,22,13,32,23,16,33,26,18,34,27,21,34,27,21,32,27,21,34,27,21,34,25,18,40,30,21,40,30,21,37,27,18,36,26,17,40,30,21,38,28,19,33,23,14,27,17,8,29,19,10,33,23,14,39,29,20,42,32,23,39,29,20,32,22,13,25,16,9,25,18,12,29,24,20,34,29,25,36,31,27,35,28,22,33,26,20,35,28,22,37,30,24,33,24,17,31,22,15,31,21,12,31,21,12,33,23,14,34,24,15,37,24,15,36,23,14,34,21,13,41,28,20,46,33,25,45,32,24,46,33,25,51,38,30,57,44,36,60,47,39,68,55,47,67,54,46,66,53,45,62,49,41,56,43,35,50,37,29,44,31,23,40,27,18,44,27,17,45,29,16,48,32,19,51,37,24,57,43,32,59,46,37,58,45,36,53,43,34,43,33,24,44,35,28,46,37,30,49,42,36,52,45,39,50,45,41,48,43,39,45,40,36,43,42,]
// var testarr = [];
// for (var i = 0; i < 4000; i++) {
//   testarr.push(27);
// }
// for (var i = 0; i < 4000; i++) {
//   testarr.push(100);
//   testarr.push(200);
// }
// var canvas = document.getElementById('canvas');
// var ctx = canvas.getContext('2d');
// // first, create a new ImageData to contain our pixels
// var imgData = ctx.createImageData(400, 400); // width x height
// var data = imgData.data;

// // copy img byte-per-byte into our ImageData
// for (var i = 0, len = 400 * 400 * 4; i < len; i++) {
//     data[i] = testarr[i];
// }

// // now we can draw our imagedata onto the canvas
// ctx.putImageData(imgData, 0, 0);


// var c = document.getElementById("myCanvas");
// var ctx = c.getContext("2d");
// var imgData = ctx.createImageData(200, 200);


// for (var i = 0; i < imgData.data.length; i += 4) {
//     imgData.data[i+0] = 255;
//     imgData.data[i+1] = 0;
//     imgData.data[i+2] = 0;
//     imgData.data[i+3] = 1;
// }

// ctx.putImageData(imgData, 10, 10);

    var img = new Image();
    img.src = 'static/visualization/rhino.jpg';
    img.onload = function() {
      draw(this);
    };

    function draw(img) {
      var canvas = document.getElementById('canvas');
      var ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      img.style.display = 'none';
      var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      var data = imageData.data;
        
      var invert = function() {
        for (var i = 0; i < data.length; i += 4) {
          data[i]     = 255 - data[i];     // red
          data[i + 1] = 255 - data[i + 1]; // green
          data[i + 2] = 255 - data[i + 2]; // blue
        }
        ctx.putImageData(imageData, 0, 0);
      };

      var grayscale = function() {
        for (var i = 0; i < data.length; i += 4) {
          var avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
          data[i]     = avg; // red
          data[i + 1] = avg; // green
          data[i + 2] = avg; // blue
        }
        ctx.putImageData(imageData, 0, 0);
      };

      var invertbtn = document.getElementById('invertbtn');
      invertbtn.addEventListener('click', invert);
      var grayscalebtn = document.getElementById('grayscalebtn');
      grayscalebtn.addEventListener('click', grayscale);
    }


});





